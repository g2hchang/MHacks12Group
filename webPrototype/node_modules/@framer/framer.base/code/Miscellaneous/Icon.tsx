import * as React from "react"
import {
    Icon as BaseIcon,
    IconProps,
    CircleIcon as BaseCircleIcon,
    CircleIconProps,
    themes,
} from "../../../base"
import { useContext } from "react"
import { ThemeContext } from "styled-components"
import { ControlType, addPropertyControls } from "framer"
import {
    intentControls,
    iconControls,
    patternControls,
    themeControls,
} from "../propertyControls"
import { centerLayout, OmitTheme } from "../utils"

type Props = OmitTheme<IconProps> &
    OmitTheme<CircleIconProps> &
    Partial<{
        theme: string
        intent: string
        pattern: string
        canvasSize: boolean
        size: number
        circle: boolean
        width: number
        height: number
    }> & {
        icon: string
    }

const defaults: Props = {
    theme: "light",
    intent: "primary",
    pattern: "primary",
    icon: "Framer",
    canvasSize: true,
    size: 24,
    circle: true,
}

export function Icon(props: Props = defaults) {
    const themeContext = useContext(ThemeContext)
    const { theme, canvasSize, width, height, size, circle, ...rest } = props
    const IconWrapper = circle ? BaseCircleIcon : BaseIcon

    return centerLayout(
        props,
        <IconWrapper
            {...rest}
            size={canvasSize ? Math.min(width, height) : size}
            theme={themeContext || themes[theme]}
        />
    )
}

Icon.defaultProps = {
    ...defaults,
    height: defaults.size,
    width: defaults.size,
}

addPropertyControls(Icon, {
    ...themeControls(defaults.theme),
    ...intentControls(defaults.intent),
    ...patternControls(defaults.pattern, true, "circle"),
    canvasSize: {
        type: ControlType.Boolean,
        title: "Size",
        defaultValue: defaults.canvasSize,
        enabledTitle: "Canvas",
        disabledTitle: "Manual",
    },
    size: {
        type: ControlType.Number,
        title: " ",
        defaultValue: defaults.size,
        min: 0,
        hidden: ({ canvasSize }) => canvasSize,
    },
    circle: {
        type: ControlType.Boolean,
        title: "Circle",
        defaultValue: defaults.circle,
    },
    ...iconControls(defaults.icon),
})
